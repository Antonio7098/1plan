# Sprint SPR-001 — Foundation & API

Lay the groundwork: API scaffold, DB schema, Documents CRUD, OpenAPI, tests/lint/CI.

## Meta
- Sprint ID: SPR-001
- Status: active
- Start date: <YYYY-MM-DD>
- End date: <YYYY-MM-DD>
- Links: [Overview](./overview.md) · [PRD](../../planning/prd.md) · [Technical Overview](../../planning/technical-overview.md) · [Features CSV](../features.csv)

## Objectives (Tick when achieved)
- [ ] Fastify API scaffold with health endpoint
- [ ] Prisma + SQLite dev DB and initial migrations
- [ ] Documents CRUD (create/get/list/update)
- [ ] OpenAPI spec + redoc build
- [ ] Unit tests for validators & docs repo
- [ ] Lint/format + CI skeleton

## Planned Tasks
- [ ] Initialize API, env config, logger (pino)
- [ ] Add Prisma schema (projects, docs)
- [ ] Implement docs endpoints with zod validation
- [ ] Add OpenAPI and examples
- [ ] Vitest unit tests; ESLint/Prettier
- [ ] GitHub Actions: typecheck, lint, test
- [ ] Database connection pooling and timeout configuration
- [ ] Health check endpoints (liveness, readiness, startup)
- [ ] Graceful shutdown handling (SIGTERM)
- [ ] Environment-specific configuration validation
- [ ] Database migration rollback procedures
- [ ] API versioning strategy implementation
- [ ] Request/response size limits
- [ ] Correlation ID generation and propagation

## Scope
In scope
- API scaffold, DB schema, docs CRUD
- Dev database (SQLite) and migrations

Out of scope
- Features & sprints endpoints
- Search and rate limiting

## Features in this Sprint
- [ ] FEAT-001 — API Scaffold (Fastify)
- [ ] FEAT-002 — Prisma Setup & Migrations
- [ ] FEAT-003 — DB Schema (Projects Docs Features Sprints Items) [partial]
- [ ] FEAT-004 — Documents CRUD Endpoints
- [ ] FEAT-009 — OpenAPI Spec & API Docs
- [ ] FEAT-021 — Unit Tests (Vitest)
- [ ] FEAT-025 — Linting & Formatting (ESLint Prettier)
- [ ] FEAT-026 — CI Workflow (GitHub Actions)
- [ ] FEAT-028 — Config & Secrets (dotenv)
- [ ] FEAT-032 — Docs: README Contributing OpenAPI
- [ ] FEAT-040 — Health Check Endpoints (liveness readiness)
- [ ] FEAT-041 — Graceful Shutdown Handling
- [ ] FEAT-042 — Database Connection Pooling

## Acceptance Criteria
- [ ] `npm run dev` launches API; healthcheck 200
- [ ] `POST/GET/PATCH/GET /v1/docs` works, validated
- [ ] OpenAPI available at `/docs` or artifact generated
- [ ] Unit tests pass locally and in CI

## Risks & Mitigations
- Risk: migration drift · Mitigation: lockfile and CI migration step
- Risk: validation gaps · Mitigation: zod + tests

## Dependencies
- None external

## QA & Testing
- [ ] Vitest suite for validators and handlers
- [ ] Supertest smoke for docs CRUD

## Technical Details

### Database Models
- Collections/Tables impacted: Project, Document
- New/changed fields: Project(id, name, createdAt), Document(id, projectId, kind, title, content, slug, createdAt, updatedAt)
- Constraints/validation: Document.kind enum ("prd"|"tech_overview"|"sprint_overview"|"sprint"|"freeform"); projectId foreign key
- Indexes (read/write paths): Document by projectId, kind, updatedAt; slug uniqueness per project
- Migrations: initial Project and Document tables — Backfill plan: NA
- Data retention: Documents retained indefinitely; soft delete pattern for future
