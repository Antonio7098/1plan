# Sprint SPR-005 — Search & Performance

Implement search and validate performance at small scale.

## Meta
- Sprint ID: SPR-005
- Status: planned
- Start date: <YYYY-MM-DD>
- End date: <YYYY-MM-DD>
- Links: [Overview](./overview.md) · [PRD](../../planning/prd.md) · [Technical Overview](../../planning/technical-overview.md) · [Features CSV](../features.csv)

## Objectives (Tick when achieved)
- [ ] LIKE-based search across documents (title/content)
- [ ] Optional FTS (SQLite FTS5 / Postgres tsvector) behind feature flag
- [ ] Query/index tuning; load smoke with k6

## Planned Tasks
- [ ] Search endpoints/filters with tests
- [ ] FTS migration + flag + fallback
- [ ] k6 scenario for list/search; collect p95

## Scope
In scope: search endpoints, indexes, load smoke

Out of scope: semantic search (later)

## Features in this Sprint
- [ ] FEAT-007 — Search (LIKE) Filters & Pagination
- [ ] FEAT-008 — Full-text Search (FTS/tsvector)
- [ ] FEAT-024 — Load Testing (k6)

## Acceptance Criteria
- [ ] p95 list/search within targets (doc)
- [ ] FTS can be toggled without breaking API contracts

## Risks & Mitigations
- Risk: FTS portability · Mitigation: dual-path with flags

## QA & Testing
- [ ] Integration tests for search filters
- [ ] k6 script + results recorded

## Technical Details

### Database Models
- Collections/Tables impacted: Document (indexes/FTS)
- New/changed fields: No schema changes; add search indexes and optional FTS virtual tables
- Constraints/validation: FTS sync triggers; search query validation
- Indexes (read/write paths): Document full-text search index (SQLite FTS5 or Postgres tsvector); composite index on (projectId, kind, title, updatedAt)
- Migrations: add FTS virtual table and triggers (SQLite) or tsvector column + GIN index (Postgres) — Backfill plan: rebuild FTS from existing documents
- Data retention: Search indexes maintained automatically; FTS rebuild on demand
