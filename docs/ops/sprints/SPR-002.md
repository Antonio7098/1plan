# Sprint SPR-002 — MCP Gateway

Ship MCP stdio server with tool-to-API mapping, resources, pagination, and idempotency.

## Meta
- Sprint ID: SPR-002
- Status: completed ✅
- Start date: 2025-08-20
- End date: 2025-08-20
- Links: [Overview](./overview.md) · [PRD](../../planning/prd.md) · [Technical Overview](../../planning/technical-overview.md) · [Features CSV](../features.csv)

## Objectives (Tick when achieved)
- [x] MCP server scaffold (stdio) with config (API URL/TOKEN)
- [x] Tools mapped to API operations (docs/features/sprints)
- [x] Read-only resources for common lists
- [x] Cursor pagination and idempotency supported
- [x] RequestId propagation MCP→API
- [x] E2E smoke (MCP -> API -> DB)

## Planned Tasks
- [x] Create MCP server (TypeScript) with zod arg validation
- [x] Implement tools: create/list/get/update for docs/features/sprints
- [x] Map errors (422/404/409/429/5xx) to tool errors
- [x] Add examples/scripts to exercise tools
- [x] E2E smoke via CLI, ensure idempotency
- [x] MCP client authentication and session management
- [x] Input sanitization and validation (prevent injection)
- [ ] Circuit breaker for API calls with fallback modes
- [x] MCP tool timeout and cancellation handling
- [x] Tool execution audit logging
- [ ] Resource quota enforcement per client
- [ ] Tool permission matrix (who can use what)

## Scope
In scope: MCP + mappings + pagination/idempotency

Out of scope: search, rate limits (handled in SPR-004)

## Features in this Sprint
- [x] FEAT-016 — MCP Server Scaffold (stdio)
- [x] FEAT-017 — MCP Tools → API Mapping
- [x] FEAT-018 — MCP Resources (read-only lists)
- [ ] FEAT-031 — Cursor Pagination Contracts
- [x] FEAT-012 — Idempotency Keys for Write Ops
- [x] FEAT-011 — RequestId Propagation End-to-End
- [ ] FEAT-035 — Retry & Backoff Policy (client-side)
- [ ] FEAT-044 — Circuit Breaker Pattern
- [x] FEAT-045 — Input Sanitization & Validation

## Acceptance Criteria
- [x] Tools function against local API
- [x] Pagination cursors honored and documented
- [x] Idempotent writes with `X-Idempotency-Key`

## Risks & Mitigations
- Risk: tool param drift vs API DTOs · Mitigation: zod shared types or codegen
- Risk: error mapping gaps · Mitigation: e2e negative tests

## QA & Testing
- [x] E2E MCP smoke covering create/list/update
- [x] Examples documented in README
